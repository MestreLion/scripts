#!/bin/bash
#
# Commands meant to run at every shell
#
# To be sourced by ~/.bashrc
#
# To run, add these lines to ~/.bashrc:
#
#	if [ -f "$SCRIPTS/home/bashrc" ] ; then
#	    . "$SCRIPTS/home/bashrc"
#	fi
#

# copies a completion definition for a command to other command(s)
complete-copy() {
	local cmd="$1"
	shift
	complete -p "$cmd" >/dev/null 2>&1 &&
	type "$@"          >/dev/null 2>&1 &&
	eval $(complete -p "$cmd") "$@"
}

if [ -f "$SCRIPTS/home/bash_aliases" ] ; then
	source "$SCRIPTS/home/bash_aliases"
fi

if [ -f "$SCRIPTS/home/bash_completion" ] ; then
	source "$SCRIPTS/home/bash_completion"
fi

declare -A termcolor
termcolor[RED]="\[\033[1;31m\]"
termcolor[GREEN]="\[\033[1;32m\]"
termcolor[BLUE]="\[\033[1;34m\]"
termcolor[WHITE]="\[\033[1;37m\]"
termcolor[GRAY]="\[\033[00m\]"

PS1="${termcolor[GREEN]}\u@\h ${termcolor[BLUE]}\w "\
"${termcolor[RED]}\$(git branch 2>/dev/null | grep '^*' | cut -c 3- | sed 's/.*/& /')"\
"${termcolor[BLUE]}\$${termcolor[GRAY]} "

# Disable the dreaded history expansion for interactive sessions
# A.K.A 'why echo "Hello World!" do not work?'
set +o histexpand # same as set +H

wine-cd() {
	local bottle="$1"
	if [[ -z "$bottle" || "$bottle" = "default" ]] ; then
		# default prefix
		cd "$HOME/.wine/drive_c"
	else
		cd "$WINEBOTTLEHOME/$bottle/drive_c"
	fi
}

wine-list() {
	ls "$@" "$WINEBOTTLEHOME"
}

wine-cmd() {
	local bottle="$1"
	local cmd="$2"

	if [[ -z "$bottle" || "$bottle" = "default" ]] ; then
		# default prefix
		prefix="$HOME/.wine"
	else
		prefix="$WINEBOTTLEHOME/$bottle"
	fi
	if [[ -z "$cmd" ]] ; then
		echo "Usage: wine-cmd BOTTLE COMMAND"
		echo ""
		echo "wine-cmd: error: please specify the command to run"
	else
		shift; shift
		env WINEPREFIX="$prefix" wine "$cmd" "$@"
	fi
}

wine-install() {
	wine-cmd "$1" "uninstaller" 2>/dev/null
}

wine-run() {
	local app="$1"
	local prefix

	if [ -z "$app" ] ; then
		echo "Usage: wine-run APP"
		echo ""
		echo "wine-run: error: please specify the application to run"
	else
		if [ ! -d "$WINEBOTTLEHOME/$app" ] ; then
			# default prefix
			prefix="$HOME/.wine"
		else
			prefix="$WINEBOTTLEHOME/$app"
		fi
		env WINEPREFIX="$prefix" wine cmd /c c:\run-$app.bat
	fi
}
